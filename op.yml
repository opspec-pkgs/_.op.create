name: github.com/opspec-pkgs/_.pkg.create
description: |
  Internal pkg for opspec-pkgs/maintainers which automates creation of an official pkg.

  includes:
  - creation of github repo
  - adding maintainers team as admins of repo
  - cloning github repo
  - generation of op.yml
  - running [bootstrap](https://github.com/opspec-pkgs/_.pkg.bootstrap)
inputs:
  githubAccessToken:
    string:
      constraints: { minLength: 1 }
      isSecret: true
      description: |
        personal access token for github; see
        [creating a personal access token](https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/)
         for how to create a github access token. It will need scopes admin:org, repo, and admin:repo_hook.

        > note: before running for the first time, you will have to authorize travis-ci to access the opspec-pkgs org on your behalf;
        > see https://github.com/settings/connections/applications/f244293c729d5066cf27
        > there is currently no way to automate this initial authorization.
  githubUsername:
    string:
      constraints: { minLength: 1 }
  name:
    string:
      constraints: { minLength: 3 }
      description: name of the pkg, excluding the `github.com/opspec-pkgs/` prefix
  description:
    string:
      constraints: { minLength: 1 }
      description: description of the pkg
  srcDir:
    dir:
      description: pkg will be initialized and cloned to `name` subdir
      default: .
outputs:
  srcDir:
    dir:
      description: as provided plus a new subdir containing initialized pkg
version: 2.0.0
run:
  serial:
    - op:
        pkg: { ref: github.com/opspec-pkgs/github.repo.create#1.0.0 }
        inputs:
          name:
          accessToken: $(githubAccessToken)
          description: $(description)
          isWikiEnabled: 'false'
          org: opspec-pkgs
    - op:
        pkg: { ref: github.com/opspec-pkgs/github.repo.team.add#1.0.0 }
        inputs:
          accessToken: $(githubAccessToken)
          repo: $(name)
          teamId: '2422602'
          org: opspec-pkgs
          permission: admin
    - op:
        pkg: { ref: github.com/opspec-pkgs/travis-ci.enable#1.0.1 }
        inputs:
          githubAccessToken:
          repo: opspec-pkgs/$(name)
    - op:
        pkg: { ref: github.com/opspec-pkgs/handlebarsjs.render-dir#1.0.0 }
        inputs:
          data:
            name: $(name)
            description: $(description)
          templates: $(/templates)
        outputs:
          renderedPkg: result
    - op:
        pkg: { ref: github.com/opspec-pkgs/_.pkg.bootstrap#1.0.0 }
        inputs:
          srcDir: $(renderedPkg)
        outputs:
          bootstrappedPkg:
    - op:
        pkg: { ref: github.com/opspec-pkgs/fs.cp-dir#2.0.0}
        inputs:
          src: $(bootstrappedPkg)
          dst: $(srcDir)
          dstPath: /$(name)
        outputs:
          srcDir:
    - op:
        pkg: { ref: github.com/opspec-pkgs/git.clone-https#1.0.0 }
        inputs:
          url: https://github.com/opspec-pkgs/$(name).git
          username: $(githubUsername)
          password: $(githubAccessToken)
        outputs:
          clonedGitRepo: repo
    - op:
        pkg: { ref: github.com/opspec-pkgs/fs.cp-dir#2.0.0}
        inputs:
          src: $(clonedGitRepo)
          dst: $(srcDir)
          dstPath: /$(name)
        outputs:
          srcDir: