name: github.com/opspec-pkgs/_.pkg.create
description: internal pkg for opspec-pkgs/maintainers which automates creation of an official pkg
inputs:
  githubAccessToken:
    string:
      constraints: { minLength: 1 }
      isSecret: true
      description: |
        personal access token for github; see
        https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/ for how to create a github access token.
        It will need scopes admin:org, repo, and admin:repo_hook.
        > note: before running for the first time, you will have to authorize travis-ci to access the opspec-pkgs org on your behalf; see https://github.com/settings/connections/applications/f244293c729d5066cf27
        > there is currently no way to automate this initial authorization.
  name:
    string:
      constraints: { minLength: 3 }
      description: name of the pkg
  description:
    string:
      constraints: { minLength: 1 }
      description: description of the pkg
version: 1.0.1
run:
  serial:
    - op:
        pkg: { ref: github.com/opspec-pkgs/github.repo.create#1.0.0 }
        inputs:
          name:
          accessToken: $(githubAccessToken)
          description: $(description)
          isWikiEnabled: 'false'
          org: opspec-pkgs
    - op:
        pkg: { ref: github.com/opspec-pkgs/github.repo.team.add#1.0.0 }
        inputs:
          accessToken: $(githubAccessToken)
          repo: $(name)
          teamId: '2422602'
          org: opspec-pkgs
          permission: admin
    - op:
        pkg: { ref: github.com/opspec-pkgs/travis-ci.enable#1.0.0 }
        inputs:
          githubAccessToken:
          repo: opspec-pkgs/$(name)
